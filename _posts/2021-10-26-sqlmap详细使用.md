---
layout: post   	
catalog: true 	
tags:
    - tool
---



# SQLMAP可对URL做什么

* 判断可注入的参数
* 判断可以用哪种SQL注入技术来注入
* 识别出是哪种数据库
* 根据用户选择，读取哪些数据

# 五种注入模式

* 基于布尔的盲注
* 基于时间的盲注
* 基于报错注入
* 联合查询注入
* 堆查询注入，可同时执行多条语句的注入

# 支持哪些数据库

* MySQL、Oracle、PostgreSQL
* Microsoft SQL Server、Microsoft Access、IBM DB2
* SQLite、Firebird、Sybase、SAP MaxDB

# 必备参数

## 默认参数

参数 `--batch` 表示当需要选择 `y/n`时，默认选择 `y`

## 观察数据

* `-v`参数，共有七个等级，默认为1
* `-v 0` 只显示python错误以及严重的信息
* `-v 1` 同时显示基本信息和警告信息
* `-v 2` 同时显示debug信息（调试信息）
* `-v 3` 同时显示注入的payload
* `-v 4` 同时显示HTTP请求
* `-v 5` 同时显示HTTP响应头
* `-v 6` 同时显示HTTP响应页面
* 若想看到sqlmap发送的测试payload最好是等级3

## 获取目标方式

### 直接连接到数据库

* 参数：`-d`
* 对单个数据库实例运行sqlmap
* `python sqlmap.py -d "mysql://admin:admin@192.168.1.1:3306/testdb" -f --banner --dbs --users`

### 目标URL

* 参数：`-u或--url`
* 格式：`http(s)://target_url[:port]/[...]`

### 从Burp代理中获取日志

* 参数：`-l`
* 把Burp proxy中的日志直接导出来交给sqlmap检测

### 从文本中获取多个目标扫描

* 参数：`-m`
* url保存在文本中，sqlmap会一个一个的检测

### 从文件中加载HTTP请求

* 参数：`-r`
* 可以跳过设置一些其他参数，如cookie、post数据
* 当请求是HTTPS的时候，需要配合`--force-ssl`参数使用，或可以在Host头后面加上`:443`

### 处理Google的搜索结果

* 参数：`-g`
* sqlmap可以检测注入Google的搜索结果中的get参数
* 例：`python sqlmap.py -g "inurl:\".php?id=1\""`

### 从一个配置加载选项INI文件

* 参数：`-c`
* 加载sqlmap.conf文件里的相关配置



## 请求方式

### http数据

* 参数：`--data`
* 此参数是把数据以post方式提交，sqlmap会像检测get参数一样检测post的参数
* 例：`python sqlmap.py -u "http://www.target.com/test.php" --data="id=1" -f --banner --dbs --users`

### 参数拆分字符

* 参数：`--param-del`
* 当get或post的数据需要用其他字符分割测试参数的时候需要用到此参数
* 例：`python sqlmap.py -u "http://www.target.com/test.php" --data="query=foobar;id=1" --param-del=";"-f--banner--dbs--users`

### HTTP cookie头

* 参数：`--cookie、--load-cookies、--drop-set-cookie`
* 应用： web应用需要登录的时候、想在头参数中测试sql注入时
* 不想接收`set-cookie`可使用`--drop-set-cookie`参数来拒接

### HTTP User-Agent头

* 参数：`--user-agent、--random-agent`
* 可以使用`--user-agent`参数来修改，同时可以使用`--random-agent`参数来随机从`./txt/user-agents.txt`中获取
* 当`--level`参数设定为3或者以上的时候，会尝试对User-Agent进行注入

### HTTP Host头

* 参数：`--host`
* 可以手动设置HTTP Host头的值

### HTTP Referer头

* 参数：`--referer`
* sqlmap可以在请求中伪造HTTP中的referer，当`--level`参数设定为3或以上时，会尝试referer注入

### 额外的HTTP头

* 参数：`--headers`
* 可以通过`--headers`参数来增加额的HTTP头

### HTTP认证保护

* 参数：`--auth-type、--auth-cred`
* 登录HTTP的认证保护支持三种方式

Basic、Digest、NTLM

* `python sqlmap.py -u "http://www.target.com/test.php?id=1"--auth-type Basic --auth-cred"testuser:testpass"`

### HTTP协议的证书认证

* 参数：`--auth-type、--auth-cert`
* 当web服务器需要客户端证书进行身份验证时，需要提供两个文件：`key_file`，`cert_file`，`key_file`是格式为PEM文件，包含着你的私钥，`cert_file`是格式为PEM的连接文件

### HTTP协议私有密钥身份验证

* 参数：`--auth-private`
* 这个选项应该在情况下，web服务器需要使用适当的客户端私钥进行身份验证，提供的价值应该是PEM格式`key_file`包含你的私钥

### HTTP(s)代理

* 参数：`--proxy、--proxy-cred、--ignore-proxy`

### Tor网络匿名

* 参数：`--tor、--tor-port、--tor-type、--check-tor`

### HTTP请求延迟

* 参数：`--delay`
* 可设定两个HTTP(s)请求间的延迟，设定为0.5的时候是半秒，默认没有延迟

### 设定超时时间

* 参数：`--timeout`
* 可以设定一个HTTP(s)请求超过多久判定为超时，默认30秒

### 设定重试超时

* 参数：`--retries`
* 当HTTP(s)超时时，可设定重新尝试连接次数，默认3次

### 设定随机改变的参数值

* 参数：`--randomize`
* 可以设定某个参数值在每一次请求中随机的变化，长度和类型会与提供的初始值一样

### 利用正则过滤目标网址

* 参数：`--scope`
* `python sqlmap.py -l burp.log --scope="(www)?\.target\.(com|net|org)"`

### 避免过多的错误请求被屏蔽

* 参数：`--safe-url、--safe-freq`
* `--safe-url`提供一个安全不错误的连接，每隔一段时间都去访问一下
* `--safe-freq`提供一个安全不错误的连接，每次测试请求之后都再访问一遍安全连接

### 使用SSL/HTTPS

* 参数：`--force-ssl`

* 用户想要强迫使用SSL/HTTPS请求向目标，可使用此参数

### 关掉URL参数值编码

* 参数：`--skip-urlencode`
* 根据参数位置，它的值默认将被URL编码，但是有时候后端的web服务器不遵守RFC标准，只接收不经过URL编码的值，这时候需要用`--skip-urlencode`参数

### 每次请求时执行自定义的python代码

* 参数：`--eval`
* 需要根据某个参数的变化，而修改另一个参数，才能形成正常的请求，这时就可以用`--eval`参数在每次请求时根据所写python代码做完修改后请求
* `python sqlmap.py -u "http://www.target.com/test.php?id=1&hash=c121c21c22454c55c"--eval="import hashlib;hash=hashlib.md5(id).hexdigest()"`

## 优化

### 收集优化

* 参数：`-o`
* 这个参数是一个别名，隐式地设置以下选项和交换机

`--keep-alive`

`--null-connection`

`--threads=3`

### 输出预测

* 参数：`--predict-output`
* 这是用于推理算法顺序检索的值的字符统计预测

### HTTP活动

* 参数：`--keep-alive`
* 指示sqlmap HTTP(s)使用持久连接

### HTTP空连接

* 参数：`--null-connection`
* 可以用再在盲目注入技术来区分True和False响应

### 并发HTTP(S)请求

* 参数：`--threads`
* 可以指定并发HTTP(s)请求的最大数量

## 探测

### 测试参数

* 参数：`-p、--skip`

### URL注入点

* 参数：`-u`
* `python sqlmap.py -u "网址"`

### 指定数据库

* 参数：`--dbms`
* 默认情况sqlmap会自动探测web应用后端的数据库是什么

### 风险等级

* 参数：`--risk`
* 共4个等级

1 测试大部分测试语句

2 增加基于事件的测试语句

3 增加OR语句的sql注入测试

### 页面比较

* 参数：`--string、--not-string、--regexp、--code`
* 参数：`--text-only、--titles`

## 注入技术

### 测试是否是注入

* 参数：`--technique`
* B：布尔型
* E：报错型
* U：联合查询
* S：多语句查询
* T：时间延迟注入

### 设定延迟注入的时间

* 参数：`--time-sec`
* 当使用继续时间的盲注时，时刻使用该参数设定延迟时间，默认为5秒

### 设定union查询字段数

* 参数：`--union-cols`
* 默认情况下sqlmap测试union查询注入会测试1-10个字段数，当`--level`为5时，它会增加到测试50个字段数

### 设定union查询使用的字符

* 参数：`--union-char`
* 默认情况下sqlmap针对union查询的注入会使用null字符

### DNS泄露攻击

* 参数：`--dns-domain`
* 若用户控制一台机器注册为DNS域服务器，则可以用

### 二阶sql注入

* 参数：`--second-order`
* 有时在注入点输入数据看返回结果的时候并不是当前页面，而是另一个页面，这时，需要指定到哪个页面获取响应判断真假，所以该参数后加URL地址

## 指纹

### 数据库管理系统指纹

* 参数：`-f 或--fingerprint`

## 列数据

### 标志

* 参数：`-b、--banner`
* 大多数数据库都有一个函数可返回数据库版本号，通常是数据库中的函数version()或变量@@version

### 用户

* 参数：`--current-user`
* 获取管理数据的用户

### 当前数据库

* 参数：`--current-db`
* 返回当前连接的数据库

### 当前用户是否为管理员

* 参数：`--is-dba`
* 判断当前用户是否为管理员，若是返回True

### 列出数据库管理用户

* 参数：`--users`
* 当前用户有权限读取包含所有用户的表的权限时，就可以列出所有管理用户

### 列出并爆破数据库用户的hash

* 参数：`--passwords`
* 当用户有权限读取包含用户密码的表的权限时，sqlmap会列举出用户的hash，并尝试爆破
* `python sqlmap.py -u "网站" --passwords -v1`
* 也可以提供`-U`参数来指定爆破那个用户的hash

### 列出数据库管理员权限

* 参数：`--privileges`
* 

## 爆破

## 用户定义函数注入

## 系统文件操作

## 操作系统

## 对Windows注册表操作

### 读注册表

`--reg-read`

### 写注册表

`--reg-add`

### 删除注册表

`--reg-del`

### 注册表辅助选择

* `--reg-key`
* `--reg-value`
* `--reg-data`
* `--reg-type`

## 其他参数

### 使用参数缩写

`-Z`，参数太长，可以使用缩写模式

### 成功sql注入时警告

`--alert`

### 设定会发的答案

`--answers`，希望sqlmap提出输入时，自动输入自己想要的答案

### 发现sql注入时发出蜂鸣声

`--beep`

### 启发式检测WAF/IPS/IDS保护

`--check-waf`

### 清理sqlmap的UDF(s)和表

`--cleanup`

清除注入时产生的udf与表

### 使用HTTP参数污染

`-hpp`

http参数污染可能会绕过WAF/IPS/IDS，对ASP/IIS与ASP.NET很有效

### 测试WAF/IPS/IDS保护

`--identify-waf`

尝试找出WAF/IPS/IDS保护，方便用户做绕过，大约支持30种

### 模仿智能手机

`--mobile`

当服务器只能接收移动端访问时

### 启发式判断注入

`--smart`

对非常多URL进行测试，为节省时间，只对能够快速判断为注入点的报错点进行注入

### 选择测试的有效载荷/标题

`--test-filter`

过滤测试的有效载荷和标题，如，所有有效载荷都有ROW关键字，可使用`--test-filter=ROW`

### 初级用户向导参数

`--wizard`

面向初级用户的参数，一步步教你如何输入针对目标注入



