---
layout: post   	
catalog: true 	
tags:
    - Docker
---

# 1. 为什么需要最佳实践

主要有以下几方面的需要:

- 提高安全性
- 优化Docker image 的大小
- 充分利用Docker有用的功能
- 编写易于维护的Dockerfile 文件

# 2. 容器应该是短暂的

**短暂** 意味着可以停止和销毁容器，并且创建一个新容器并部署好所需的设置和配置工作量应该是极小的

容器最初是针对无状态的应用而设计的，在逻辑上，容器内应用产生的临时数据也属于该容器的一部分。用容器创建起一个服务，用完之后销毁它。这些应用本身没有状态，状态通常保存在容器外部的数据库里，这是经典的架构与用法，也是容器的设计哲学。  
  
但当用户想把数据库本身也放到容器中时，事情就变得不一样了：数据库是有状态的，为了维持这个状态不随容器停止而销毁，数据库容器需要在容器上打一个洞，与底层操作系统上的数据卷相联通。这样的容器，不再是一个能够随意创建，销毁，搬运，转移的对象，而是与底层环境相绑定的对象。因此，传统应用使用容器的诸多优势，对于数据库容器来说都不复存在。

**总结**

对于开发环境而言，可以将数据库放入Docker中。对于生产环境的无状态应用，甚至一些带有衍生状态的不甚重要衍生数据系统（如Redis缓存），Docker也是一个不错的选择。但对于生产环境的核心关系型数据库而言，使用Docker前还望三思

# 3. 一个容器只运行一个进程

应该保证在一个容器中只运行一个进程。将多个应用解耦到不同容器中，保证了容器的横向扩展和复用。例如 web 应用应该包含三个容器：web应用、数据库、缓存
# 4. docker镜像

使用固定版本的镜像，带有 `latest`标签的镜像就是最新版本的镜像，存在不稳定或未发现的问题

Alpine 镜像具备启动容器应用所需的一切，但更加轻量级

# 5. 使用 .dockerignore 文件

创建一个名为`.dockerignore`的文件，然后列出所有要忽略的文件和文件夹，在构建镜像时，Docker会查看其内容并忽略其中指定的任何内容

# 6. 使用 docker的多阶段构建

多阶段构建功能允许我们在构建过程中使用多个临时镜像，但只保留最新的镜像作为最终产物

# 7. 使用最低权限的用户

默认情况下，当Dockerfile没有指定用户时，它使用root用户。但实际上大多数情况下没有必要以root权限运行容器。最佳做法是在Docker镜像中创建一个专用用户和专用组来运行应用程序，并且在容器内使用该用户来运行应用程序。一些镜像中已经包含了一个通用用户，我们可以使用它。因此，我们不需要创建新的用户。例如，node.js 图像已经捆绑了一个名为 `node` 的通用用户，可以直接使用该用户在容器内运行应用程序